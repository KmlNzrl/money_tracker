# Create a table for Transactions
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    amount NUMERIC(10, 2) NOT NULL,
    savings_goal_id INT,
    type VARCHAR(10) CHECK (type IN ('Income', 'Expense')) NOT NULL,
    category_id INT NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

# Create a table for savings_goal
CREATE TABLE savings_goals (
    id SERIAL PRIMARY KEY,
    goal_name VARCHAR(100) NOT NULL,
    target_amount DOUBLE PRECISION NOT NULL,
    current_amount DOUBLE PRECISION DEFAULT 0,
    start_date DATE NOT NULL,
    target_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

# Add foreign key constraint 
ALTER TABLE transactions
ADD CONSTRAINT fk_savings_goal
FOREIGN KEY (savings_goal_id)
REFERENCES savings_goals(id)
ON DELETE SET NULL;

# Create a table for categories
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
);

# Modify after run all above
ALTER TABLE transactions
ADD COLUMN category_id INT;

ALTER TABLE transactions
ADD CONSTRAINT fk_category
FOREIGN KEY (category_id)
REFERENCES categories(id);

# Insert default categories
INSERT INTO categories (name)
VALUES
('Commitment'),
('Savings'),
('Shopping'),
('Food'),
('Transportation'),
('Subscription'),
('Others');

# Create User table
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
